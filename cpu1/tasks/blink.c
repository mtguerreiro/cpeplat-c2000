/*
 * blink.c
 *
 *  Created on: 01.12.2020
 *      Author: mguerreiro
 */

//=============================================================================
/*-------------------------------- Includes ---------------------------------*/
//=============================================================================
#include "blink.h"

/* Kernel */
#include <ti/sysbios/BIOS.h>
#include <ti/sysbios/knl/Task.h>

/* Device and drivers */
#include "driverlib.h"
#include "inc/hw_ipc.h"

/* Libs */
#include "clibs/serial.h"
//=============================================================================

//=============================================================================
/*--------------------------------- Globals ---------------------------------*/
//=============================================================================
uint32_t blinkPeriod;
//=============================================================================

//=============================================================================
/*-------------------------------- Prototypes -------------------------------*/
//=============================================================================
static void blinkInitialize(void);
//static uint32_t blinkPeriodUpdate(serialDataExchange_t *data);
//=============================================================================

//=============================================================================
/*---------------------------------- Task -----------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
void blink(UArg a0, UArg a1){

    blinkInitialize();
    blinkPeriod = 1000;

    GPIO_writePin(40, 0);
    while(1){
        GPIO_togglePin(BLINK_CONFIG_LED);
        Task_sleep(blinkPeriod);
    }
}
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*---------------------------- Static functions -----------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static void blinkInitialize(void){

    /* Initialize GPIO and configure the GPIO pin as a push-pull output */
//    Device_initGPIO();
    GPIO_setPadConfig(BLINK_CONFIG_LED, GPIO_PIN_TYPE_STD);
    GPIO_setDirectionMode(BLINK_CONFIG_LED, GPIO_DIR_MODE_OUT);

    GPIO_setPadConfig(40, GPIO_PIN_TYPE_STD);
    GPIO_setDirectionMode(40, GPIO_DIR_MODE_OUT);
}
//-----------------------------------------------------------------------------
void blinkPeriodUpdate(uint32_t period){

    blinkPeriod = period;
}
//-----------------------------------------------------------------------------
//static uint32_t blinkPeriodUpdate(serialDataExchange_t *data){
//
//    blinkPeriod = *data->buffer++ << 8;
//    blinkPeriod = blinkPeriod | *data->buffer;
//
//    HWREG(IPC_BASE + IPC_O_SENDCOM) = 0;
//    HWREG(IPC_BASE + IPC_O_SENDDATA) = blinkPeriod;
//    HWREG(IPC_BASE + IPC_O_SET) = 1UL << 0;
//
//    return 0;
//}
//-----------------------------------------------------------------------------
//=============================================================================
