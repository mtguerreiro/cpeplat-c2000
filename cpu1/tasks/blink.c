/*
 * blink.c
 *
 *  Created on: 01.12.2020
 *      Author: mguerreiro
 */

//=============================================================================
/*-------------------------------- Includes ---------------------------------*/
//=============================================================================
#include "blink.h"

/* Kernel */
#include <ti/sysbios/BIOS.h>
#include <ti/sysbios/knl/Task.h>

/* Device and drivers */
#include "driverlib.h"
#include "inc/hw_ipc.h"

/* Libs */
#include "clibs/serial.h"
//=============================================================================

//=============================================================================
/*--------------------------------- Globals ---------------------------------*/
//=============================================================================
uint32_t blinkPeriod;
//=============================================================================

//=============================================================================
/*-------------------------------- Prototypes -------------------------------*/
//=============================================================================
static void blinkInitialize(void);
//=============================================================================

//=============================================================================
/*---------------------------------- Task -----------------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
void blink(UArg a0, UArg a1){

    blinkInitialize();
    blinkPeriod = 1000;

    while(1){
        GPIO_togglePin(BLINK_CONFIG_LED);
        Task_sleep(blinkPeriod);
    }
}
//-----------------------------------------------------------------------------
//=============================================================================

//=============================================================================
/*---------------------------- Static functions -----------------------------*/
//=============================================================================
//-----------------------------------------------------------------------------
static void blinkInitialize(void){

    /* Initialize GPIO and configure the GPIO pin as a push-pull output */
    GPIO_setPadConfig(BLINK_CONFIG_LED, GPIO_PIN_TYPE_STD);
    GPIO_setDirectionMode(BLINK_CONFIG_LED, GPIO_DIR_MODE_OUT);
}
//-----------------------------------------------------------------------------
void blinkPeriodUpdate(uint32_t period){

    blinkPeriod = period;
}
//-----------------------------------------------------------------------------
//=============================================================================
